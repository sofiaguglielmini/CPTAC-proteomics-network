---
title: "Comparative Network Analysis of CPTAC Proteomics Data in Lung Squamous Cell Carcinoma"
author: "Sofia Guglielmini"
format:
  html:
    toc: true
    code-fold: true
    theme: cosmo
    embed-resources: true
    fig-width: 10
    fig-height: 6
execute:
  echo: false
  warning: false
  engine: python
---

```{python}
#| include: false

import numpy as np
import pandas as pd
import pickle
import matplotlib.pyplot as plt
import seaborn as sns
from pathlib import Path
from IPython.display import display, Image

results_dir = Path('results')
tables_dir = results_dir / 'tables'
figures_dir = results_dir / 'figures'

sns.set_style("whitegrid")
plt.rcParams['figure.dpi'] = 100
```

## Background

Proteomic measurements provide insight into cellular functions by quantifying the abundance of proteins, which in turn mediate biological processes. Proteins often interact as parts of complex networks, regulating their behavior in a coordinated way. In diseased conditions, dysregulation often manifests as an alteration of the coordination system among proteins, in addition to absolute changes in protein abundance (Zhang et al. 2018). Network models offer an effective framework for studying such coordinated behavior by estimating the conditional dependence structure among proteins.
Here, we perform a comparative network analysis of lung squamous cell carcinoma (LSCC) proteomics data from the CPTAC Pan-Cancer project. The analysis focuses on differences between normal and tumor samples, with emphasis on network topology, hub structure, edge-level changes, robustness, and biological interpretability.

## Data

We analyze harmonized gene-level proteomics Pan-Cancer data generated by the National Cancer Institute’s Clinical Proteomic Tumor Analysis Consortium (CPTAC) and processed using the Baylor College of Medicine pipeline (see STAR methods, Li et al. 2023). Protein abundances are measured using LC-MS/MS-based mass spectrometry and aggregated to gene-level protein abundance, estimated by aggregating peptide intensities.

The analysis was restricted to the LSCC cohort and genes were restricted to the KEGG cancer-related pathways (hsa05200).

Proteomics measurements were furthermore filtered to keep genes with at most 20% missing values, while the remaining missing values were imputed using k-nearest neighbors (k = 10). Outlier genes (kurtosis > 10) and genes with zero variance were removed prior to network estimation. The data was scaled and centered prior to network inference. 

```{python}
with open(results_dir / 'data_processed.pkl', 'rb') as f:
    dat = pickle.load(f)

summary = pd.DataFrame({
    'Dataset': ['All Samples', 'Normal', 'Tumor'],
    'N Samples': [dat['X_all'].shape[0], dat['X_norm'].shape[0], dat['X_tumor'].shape[0]],
    'N Genes': [dat['X_all'].shape[1], dat['X_norm'].shape[1], dat['X_tumor'].shape[1]]
})
```

After preprocessing, the dataset includes `{python} dat['X_all'].shape[0]` samples and `{python} dat['X_all'].shape[1]` genes. A summary of sample sizes by condition is provided below.

```{python}
display(summary)
```

## Correlation Matrices

We start by displaying the empirical correlation matrix of the processed data by condition (normal vs tumor), shown below. We also display the difference between the two correlation matrices (tumor - normal).

Both correlation matrices are visually sparse, with a mix of positive and negative correlations. The difference matrix reveals both strengthened and weakened pairwise correlations in tumor samples, suggesting complex rewiring of protein interactions in cancer. No evident block structure is observed in either condition or in the difference matrix.

::: {.panel-tabset}

## Normal

```{python}
if 'data' not in locals():
    with open(results_dir / 'data_processed.pkl', 'rb') as f:
        data = pickle.load(f)

X_norm = data['X_norm']
corr_norm = X_norm.corr()

fig, ax = plt.subplots(figsize=(8, 7.5))
sns.heatmap(corr_norm, cmap='RdBu_r', center=0, vmin=-1, vmax=1, 
            xticklabels=False, yticklabels=False, cbar_kws={'label': 'Correlation'},
            ax=ax)
ax.set_title('Normal', fontsize=14, fontweight='bold')
plt.tight_layout()
display(fig)
plt.close()
```

## Tumor

```{python}
X_tumor = data['X_tumor']
corr_tumor = X_tumor.corr()

fig, ax = plt.subplots(figsize=(8, 7.5))
sns.heatmap(corr_tumor, cmap='RdBu_r', center=0, vmin=-1, vmax=1,
            xticklabels=False, yticklabels=False, cbar_kws={'label': 'Correlation'},
            ax=ax)
ax.set_title('Tumor', fontsize=14, fontweight='bold')
plt.tight_layout()
display(fig)
plt.close()
```

## Difference

```{python}
corr_diff = corr_tumor - corr_norm

fig, ax = plt.subplots(figsize=(8, 7.5))
max_abs = np.max(np.abs(corr_diff))
sns.heatmap(corr_diff, cmap='RdBu_r', center=0, vmin=-max_abs, vmax=max_abs,
            xticklabels=False, yticklabels=False, cbar_kws={'label': 'Difference'},
            ax=ax)
ax.set_title('Tumor - Normal', fontsize=14, fontweight='bold')
plt.tight_layout()
display(fig)
plt.close()
```

:::

## Network Analysis

Correlation matrices only summarize pairwise relationships and do not account for indirect effects. To capture direct protein-protein interactions, protein networks were inferred using sparse Gaussian graphical models (GGMs). Under this (Gaussian copula) framework, edges represent conditional dependencies between proteins, quantified via partial correlations derived from the estimated inverse covariance (precision) matrix. Due to the high-dimensional setting, lasso regularization was used to induce sparsity and permit estimation. The penalty parameter is manually tuned to $2.5\sqrt{\log(p)/n}$, where $p$ is the number of genes and $n$ the number of samples in each condition (Friedman et al., 2008).

As proteomic measurements are aggregated at the gene level, throughout the analysis, network nodes represent genes, with protein-level measurements and annotations collapsed per gene.

Separate networks for normal samples and tumor samples are estimated, and shown below.
Communities are detected using the Louvain method for community detection. Nodes are scaled by weighted degree, and colored by community membership. Edge widths are scaled by absolute partial correlation.

```{python}
#| echo: false
clusters_norm = pd.read_csv(tables_dir / 'clusters_normal_internal.csv')
clusters_tumor = pd.read_csv(tables_dir / 'clusters_tumor_internal.csv')
n_comm_norm = len([c for c in set(clusters_norm['Cluster']) if c >= 0])
n_comm_tumor = len([c for c in set(clusters_tumor['Cluster']) if c >= 0])
```

Excluding isolated nodes, in the normal network we identify `{python} n_comm_norm` communities, while in the tumor network we identify `{python} n_comm_tumor` communities.
The tumor network exhibits higher density and overall connectivity compared to the normal network, suggesting increased coordination among proteins in the cancer state. Weighted degree is defined as the sum of the absolute partial correlations corresponding to edges connected to each node, capturing both the number and strength of conditional associations. 

::: {.panel-tabset}

## Normal

```{python}
display(Image(filename=figures_dir / 'network_normal.png'))
```

## Tumor

```{python}
display(Image(filename=figures_dir / 'network_tumor.png'))
```

:::

```{python}
summary_cc = pd.read_csv(tables_dir / 'network_summary_case_control.csv')
summary_cc_rounded = summary_cc.round(3)
display(summary_cc_rounded)
```

### Centrality, Stability and Biological Annotation

Node centrality was quantified using weighted degree. However, sparse network estimation is sensitive to sampling variability. To assess the robustness of hub identification, weighted-degree stability was evaluated using subsampling. First, global networks were repeatedly estimated on random subsamples (80% of observations), and the mean weighted degree (MWD) and coefficient of variation (CV, i.e. ratio of standard deviation to mean) were computed for each gene. Hub genes were defined as those with high mean weighted degree. The CV was used to assess stability, with lower CV indicating more robust estimates. The top 10 hub genes in each condition are summarized below. The library mygene was used for annotation of the full gene names. The table below displays the top 10 hub genes ranked by weighted degree in the global network.

```{python}
from IPython.display import display, Markdown

top_norm = pd.read_csv(tables_dir / 'top_hubs_normal.csv')
top_tumor = pd.read_csv(tables_dir / 'top_hubs_tumor.csv')

display(Markdown("#### Hubs in Normal Network"))
display(top_norm.head(10))

display(Markdown("#### Hubs in Tumor Network"))
display(top_tumor.head(10))
```

The main hubs in the normal network include genes encoding G-protein subunits (GNAQ, GNA11, GNG11) and downstream signaling components (PLCB1, MAPK3). Additional hubs include genes involved in cytokine and growth factor signaling (IL6ST, TGFBR2), as well as genes associated with extracellular matrix structure and cell–matrix interactions (LAMB2, COL4A1).

The hubs in the tumor network include genes associated with DNA mismatch repair (MSH2, MSH6), kinase-mediated signaling (PRKCB, PIK3CD), and transcriptional regulation (SPI1).

The functional descriptions of key hub genes were obtained from UniProt (The UniProt Consortium, 2025, www.uniprot.org).

We then compared weighted degree between normal and tumor networks to identify genes with altered centrality. The top 10 genes ranked by difference in average (bootstrapped) weighted degree between conditions are summarized below.

```{python}
hub_comp = pd.read_csv(tables_dir / 'hub_comparison_case_control.csv')
hub_comp_cols = hub_comp[['Gene', 'MWD_Normal', 'CV_Normal', 'MWD_Tumor', 'CV_Tumor', 
                  'Difference', 'Gene_Name']].head(10).round(3)
display(Markdown("#### Hub Differences Between Conditions"))
display(hub_comp_cols)
```

Several genes (PRKCB, MSH2, MSH6, SPI1, PIK3CD, CDH1, JUP, NFKB1, LAMB3) change from isolated or weakly connected nodes in the normal network to highly connected nodes in the tumor network. In contrast, GNAQ shows a marked decrease in weighted degree in the tumor condition.
These shifts indicate gene-specific redistribution of network connectivity between conditions.

### Edge-level rewiring

To characterize network rewiring beyond node-level changes, we examined differences in partial correlations between normal and tumor networks. The top edges ranked by absolute change are visualized below. Edge changes indicate potential rewiring of protein coordination in the tumor condition.

```{python}
display(Image(filename=figures_dir / 'top_edge_differences.png'))
```

All the largest changes involve increased partial correlations in tumor compared to normal, suggesting strengthened direct interactions in the cancer state.

## Pathway Analysis

Since the samples are from LSCC patients, we consider the subset of genes which are in the KEGG pathway related to non-small cell lung cancer (hsa05223), which includes LSCC. For these genes, we observe a notable increase in centrality, total connectivity (sum of absolute partial correlations) and betweenness. Furthermore, we quantify how the pathway group is confirmed by the community detection algorithm in each condition, using the Herfindahl-Hirschman Index as a measure of concentration (Cruz et al., 2025; Herfindahl, 1951). The index is defined as the sum of squares of share of pathway genes in each cluster. The concentration is much higher in tumor compared to normal, indicating that the pathway genes are more concentrated within specific communities in the tumor network. This is consistent with the idea of increased coordination among cancer-related proteins in the tumor state.

```{python}
if (tables_dir / 'lscc_pathway_metrics.csv').exists():
    lscc_metrics = pd.read_csv(tables_dir / 'lscc_pathway_metrics.csv')
    lscc_metrics_rounded = lscc_metrics.round(3)
    display(lscc_metrics_rounded)
```

## Limitations and Future Directions

A main limitation of this analysis (partially addressed by the resampling-based stability analysis) is the relatively small sample size, which may limit statistical power and robustness of network estimates. Joint estimation of the networks in the two conditions could be considered to borrow strength across conditions and improve estimation accuracy (Guo et al., 2011). 

Future work could extend the current framework to larger cohorts, including pan-cancer analyses, to assess how the findings generalize across cancer types.
Integrating multi-omics data (e.g. transcriptomics, genomics) would allow investigation of whether network alterations observed at the proteomic level are supported by other molecular levels.

Finally, statistical inference for network differences was not conducted in this study. Due to the data-driven model selection, standard inference methods do not apply. Data splitting, data thinning (Dharamshi et al., 2025) or post-selection inference (Guglielmini, Claeskens, 2025) can be used to address the issue, enabling valid uncertainty quantification for network properties and group differences.

## References

Cruz J, Sun WY, Verbeke A, Hariharan IK. Single-cell transcriptomics of X-ray irradiated Drosophila wing discs reveals heterogeneity related to cell-cycle status and cell location. bioRxiv [Preprint]. 2025 Feb 11:2024.12.10.627868. 

Dharamshi A, Neufeld A, Motwani K, Gao LL, Witten D, Bien J. Generalized data thinning using sufficient statistics. Journal of the American Statistical Association. 2025 Jan 2;120(549):511-23.

Friedman J, Hastie T, Tibshirani R. Sparse inverse covariance estimation with the graphical lasso. Biostatistics. 2008 Jul;9(3):432-41.

Guglielmini S, Claeskens G. Asymptotic post-selection inference for regularized graphical models. Statistics and Computing. 2025 Apr;35(2):36.

Guo J, Levina E, Michailidis G, Zhu J. Joint estimation of multiple graphical models. Biometrika. 2011 Mar 1;98(1):1-5.

Herfindahl, Orris C. Concentration in the Steel Industry. University Microfilms, 1951.

The UniProt Consortium. UniProt: the universal protein knowledgebase in 2025. Nucleic acids research 53, no. D1 (2025): D609-D617.
